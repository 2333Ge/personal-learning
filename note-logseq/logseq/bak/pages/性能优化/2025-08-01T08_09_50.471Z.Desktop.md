- [[性能优化R]]
- ## 常规手段
- 防抖、节流限制方法执行频率
- 首屏加载慢
	- JS文件过大：代码压缩、代码分割、死代码过多
	- 渲染阻塞资源：未使用异步/延迟加载策略、同步加载的大型CSS文件
	- 大图加载慢：图片压缩、懒加载、预加载
- 网络问题：合理利用缓存：`cache-control`、CDN、[预加载自适应图片](https://web.dev/articles/preload-responsive-images?hl=zh-cn)
- ## 图片优化
- 自动图像尺寸调整、响应式优化
- 优先加载关键图片：next 使用 `priority` 属性(底层使用的`<link reload />` 预加载)，标记首屏图片，Next.js 会预加载这些图片，提高首屏渲染速度。(预加载及延伸问题可看[此对话]
- [[预加载自适应图片]]
- 延迟加载：使用 [原生 lazy loading](https://developer.mozilla.org/en-US/docs/Web/Performance/Lazy_loading)（`loading="lazy"`），未滚动到视图中的图片不会加载，提高首屏加载速度。
- 占位图（Blur Placeholder）：提供 `placeholder="blur"`，加载前先显示低分辨率模糊图
- (https://chatgpt.com/share/687a0a8e-a3c4-8012-9e2f-51724b664709))
- **图像优化服务（Image Optimization API）**
	- 服务端（默认使用 Next.js 内置的图像优化服务器）会动态生成、缓存并返回已优化的图像。
	- 优化内容包括压缩、格式转换、大小调整等。
	- 也可以配置使用第三方图像 CDN
- ## HTML & CSS
- 减少`DOM`数量，减轻浏览器渲染计算负担。
- 使用异步和延迟加载`js`文件，避免`js`文件阻塞页面渲染
- 压缩`HTML、CSS`代码体积，删除不要的代码，合并`CSS`文件，减少`HTTP`请求次数和请求大小。
- 减少`CSS`选择器的复杂程度，复杂度越高浏览器解析时间越长。
- ## JS
- 减少`DOM`操作数量
- 避免使用`with`语句、`eval`函数，避免引擎难以优化。
- 尽量使用原生方法，执行效率高。
- 将`js`文件放到文件页面底部，避免阻塞页面渲染
- 使用事件委托，减少事件绑定次数。
- 合理使用缓存，避免重复请求数据。
- ## 从 React 角度
- 组件渲染优化：合理使用`React.memo`、`useMemo`、`useCallback`API
- 列表渲染优化：
	- 确保使用稳定、唯一的key值；
	- 长列表用虚拟滚动方案，只渲染可视区域内的列表项，动态替换内容
- 状态管理优化：
	- **状态提升/下放**：将状态放在合适的组件层级
	- **状态合并**：避免频繁设置多个状态
- ## 从 Next.js 角度
- ### 合理选择渲染模式
- | 模式 | 适用场景 | 优化手段 |
  | ---- | ---- | ---- |
  | SSG | 内容不变或变化不频繁的页面 | `getStaticProps` + `revalidate` (ISR) |
  | SSR | 需要每次请求时获取最新数据的页面 | `getServerSideProps` |
  | CSR | 用户个性化、交互复杂的页面 | 动态导入 + Suspense |
- ### 资源优化
- 图片优化
  ```jsx
  import Image from 'next/image';
  
  // 自动优化图片
  <Image
    src="/profile.jpg"
    alt="Profile"
    width={500}
    height={500}
    priority // 首屏图片预加载
    quality={80} // 质量调整
    placeholder="blur" // 模糊占位
    blurDataURL="data:image/png;base64,..."
  />
  ```
- 脚本优化
  ```jsx
  import Script from 'next/script';
  
  
  // 优化第三方脚本加载
  <Script
    src="https://www.google-analytics.com/analytics.js"
    strategy="afterInteractive" // 加载策略
    onLoad={() => console.log('Script loaded')}
  />
  ```
	- `beforeInteractive`: 页面交互前加载（关键脚本）
	- `afterInteractive`: 页面交互后加载（默认）
	- `lazyOnload`: 浏览器空闲时加载
	- `worker`: (实验性) Web Worker中加载
- 字体优化
- ### 代码优化
- 动态导入 (代码分割)：`dynamic`
- 路由预加载：`Link`，自动预加载视口内的链接
- 中间件优化：按需配置，配置匹配路径
- ## 缓存优化
- API 缓存
  ```javascript
  export default function handler(req, res) {
    res.setHeader('Cache-Control', 's-maxage=60, stale-while-revalidate=120');
    res.status(200).json({ data });
  }
  ```
- 客户端缓存：SWR等
- CDN缓存
  ```javascript
  export default function handler(req, res) {
    res.setHeader('Cache-Control', 's-maxage=60, stale-while-revalidate=120');
    res.status(200).json({ data });
  }
  ```
- ## [[RN FLatList 如何进行性能优化]]
- ## 参考文章
- [前端铜九铁十面试必备八股文——性能优化](https://juejin.cn/post/7273119689185673253)
- [web.dev: 预加载自适应图片](https://web.dev/articles/preload-responsive-images?hl=zh-cn)