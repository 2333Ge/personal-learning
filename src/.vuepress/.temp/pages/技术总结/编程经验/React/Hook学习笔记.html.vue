<template><h1 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h1>
<p>å­¦ä¹ è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„</p>
<ol>
<li>Hook åŸç†</li>
<li>å’Œ class åŒºåˆ«</li>
<li>class =&gt; hook è½¬å˜æ³¨æ„äº‹é¡¹</li>
<li>å¯¹åº” Hook çš„ä½¿ç”¨åœºæ™¯</li>
<li>ç›¸æ¯” class çš„ä¼˜ç‚¹</li>
</ol>
<h1 id="ä»€ä¹ˆæ˜¯-hook" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-hook" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ Hook</h1>
<p>Hook æ˜¯ä¸€äº›å¯ä»¥è®©ä½ åœ¨<strong>å‡½æ•°ç»„ä»¶</strong>é‡Œâ€œé’©å…¥â€ <strong>React state åŠç”Ÿå‘½å‘¨æœŸ</strong>ç­‰ç‰¹æ€§çš„<strong>å‡½æ•°</strong></p>
<h1 id="ä¸ºä»€ä¹ˆä½¿ç”¨-hook" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä½¿ç”¨-hook" aria-hidden="true">#</a> <a href="https://zh-hans.reactjs.org/docs/hooks-intro.html#motivation" target="_blank" rel="noopener noreferrer">ä¸ºä»€ä¹ˆä½¿ç”¨ Hook<ExternalLinkIcon/></a></h1>
<ul>
<li>ç»„ä»¶é—´å¤ç”¨çŠ¶æ€é€»è¾‘å›°éš¾ï¼šåœ¨æ— éœ€ä¿®æ”¹ç»„ä»¶ç»“æ„çš„æƒ…å†µä¸‹å¤ç”¨çŠ¶æ€é€»è¾‘ï¼Œè¯¦è§<a href="https://react.docschina.org/docs/hooks-custom.html" target="_blank" rel="noopener noreferrer">è‡ªå®šä¹‰ Hook<ExternalLinkIcon/></a></li>
<li>å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£ ï¼šHook å°†ç»„ä»¶ä¸­ç›¸äº’å…³è”çš„éƒ¨åˆ†æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°</li>
<li>class éš¾ä»¥ç†è§£ï¼š Hook ä½¿ä½ åœ¨é class çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨æ›´å¤šçš„ React ç‰¹æ€§ï¼šReact ç»„ä»¶ä¸€ç›´æ›´åƒæ˜¯å‡½æ•°ã€‚è€Œ Hook åˆ™æ‹¥æŠ±äº†å‡½æ•°</li>
</ul>
<h1 id="ä¸ä½¿ç”¨-hook-å½±å“" tabindex="-1"><a class="header-anchor" href="#ä¸ä½¿ç”¨-hook-å½±å“" aria-hidden="true">#</a> ä¸ä½¿ç”¨ Hook å½±å“</h1>
<p>Hook æ²¡æœ‰ç ´åæ€§æ”¹åŠ¨,ä½¿ç”¨ Hook ä¸ä¼šå¯¹å·²æœ‰ç¨‹åºé€ æˆå½±å“ï¼Œ<a href="https://react.docschina.org/docs/hooks-intro.html#no-breaking-changes" target="_blank" rel="noopener noreferrer">è¯¦è§<ExternalLinkIcon/></a></p>
<h1 id="usestate" tabindex="-1"><a class="header-anchor" href="#usestate" aria-hidden="true">#</a> useState</h1>
<ul>
<li>æ•°ç»„è§£æ„è¯­æ³•ä½¿è°ƒç”¨ useState å¯ä»¥ç»™ state å–ä¸åŒçš„åå­—</li>
</ul>
<h2 id="å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¸¸è§é—®é¢˜" aria-hidden="true">#</a> å¸¸è§é—®é¢˜</h2>
<ol>
<li>props æ›´æ–°æ—¶éœ€è¦æ›´æ–° state çš„æƒ…å†µ</li>
<li>å‡½æ•°å¼å†™æ³•ï¼šæ›´æ–°åçš„ state é€šè¿‡å…ˆå‰çš„ state è®¡ç®—å¾—å‡º</li>
<li>class ä¸­ setState å›è°ƒæ€ä¹ˆå†™</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> initialCount <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token literal-property property">Count</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>Reset<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span><span class="token punctuation">)</span> <span class="token operator">=></span> prevCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span><span class="token punctuation">)</span> <span class="token operator">=></span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h1 id="useeffect" tabindex="-1"><a class="header-anchor" href="#useeffect" aria-hidden="true">#</a> useEffect</h1>
<p>effect ä¼˜åŒ–æ³¨æ„äº‹é¡¹ï¼šç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰<strong>å¤–éƒ¨ä½œç”¨åŸŸ</strong>ä¸­ä¼š<strong>éšæ—¶é—´å˜åŒ–</strong>å¹¶ä¸”åœ¨ <strong>effect ä¸­ä½¿ç”¨çš„å˜é‡</strong></p>
<p>React ä¼šç­‰å¾…æµè§ˆå™¨å®Œæˆç”»é¢æ¸²æŸ“ä¹‹åæ‰ä¼šå»¶è¿Ÿè°ƒç”¨</p>
<h2 id="æ— éœ€æ¸…é™¤çš„-effect" tabindex="-1"><a class="header-anchor" href="#æ— éœ€æ¸…é™¤çš„-effect" aria-hidden="true">#</a> æ— éœ€æ¸…é™¤çš„ effect</h2>
<ul>
<li>
<p>åœ¨ React æ›´æ–° DOM ä¹‹åè¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨åœºæ™¯ egï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œ</p>
</li>
<li>
<p>useEffect åšäº†ä»€ä¹ˆ: å‘Šè¯‰ React ç»„ä»¶éœ€è¦åœ¨æ¸²æŸ“åæ‰§è¡ŒæŸäº›æ“ä½œ</p>
</li>
<li>
<p>useEffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œå—ï¼š å®ƒåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆåœ¨ç»„ä»¶å†…éƒ¨è°ƒç”¨ useEffectï¼šå¯ä»¥åœ¨ effect ä¸­ç›´æ¥è®¿é—® state(ä½œç”¨åŸŸ) å˜é‡</p>
</li>
</ul>
<h2 id="éœ€è¦æ¸…é™¤çš„-effect" tabindex="-1"><a class="header-anchor" href="#éœ€è¦æ¸…é™¤çš„-effect" aria-hidden="true">#</a> éœ€è¦æ¸…é™¤çš„ effect</h2>
<p>å¦‚æœä½ çš„ effect è¿”å›ä¸€ä¸ªå‡½æ•°ï¼ŒReact å°†ä¼šåœ¨æ‰§è¡Œæ¸…é™¤æ“ä½œæ—¶è°ƒç”¨å®ƒ</p>
<ul>
<li>React ä½•æ—¶æ¸…é™¤ effect: React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œ</li>
</ul>
<h3 id="å¸¸è§é—®é¢˜-1" tabindex="-1"><a class="header-anchor" href="#å¸¸è§é—®é¢˜-1" aria-hidden="true">#</a> å¸¸è§é—®é¢˜</h3>
<ol>
<li>class ç»„ä»¶ä¸­åœ¨ componentDidMount ä¸­å– props ä¸­çš„æ•°æ®ï¼Œè‹¥ props æ›´æ–°çš„è¯ï¼ˆ<a href="https://zh-hans.reactjs.org/docs/hooks-effect.html#explanation-why-effects-run-on-each-update" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹<ExternalLinkIcon/></a>ï¼‰</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>handleStatusChange
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>handleStatusChange
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="2">
<li>useEffect ä¸­ä½¿ç”¨å»¶æ—¶å‡½æ•°æ—¶</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™ä¸ª effect ä¾èµ–äº `count` state</span>
      <span class="token comment">// setCount(c => c + 1); // âœ… åœ¨è¿™ä¸ä¾èµ–äºå¤–éƒ¨çš„ `count` å˜é‡</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ Bug: `count` æ²¡æœ‰è¢«æŒ‡å®šä¸ºä¾èµ–</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>åœ¨ setInterval çš„å›è°ƒä¸­ï¼Œcount çš„å€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚å› ä¸ºå½“ effect æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œå¹¶å°† count çš„å€¼è¢«ä¿å­˜åœ¨è¯¥é—­åŒ…å½“ä¸­ï¼Œä¸”åˆå€¼ä¸º 0ã€‚æ¯éš”ä¸€ç§’ï¼Œå›è°ƒå°±ä¼šæ‰§è¡Œ setCount(0 + 1)ï¼Œå› æ­¤ï¼Œcount æ°¸è¿œä¸ä¼šè¶…è¿‡ 1ã€‚</p>
<h1 id="useref" tabindex="-1"><a class="header-anchor" href="#useref" aria-hidden="true">#</a> useRef</h1>
<p>ç±»æ¯” class ç»„ä»¶ä¸­çš„å˜é‡</p>
<!-- toast reload æ —å­ -->
<h2 id="é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜" aria-hidden="true">#</a> é—®é¢˜</h2>
<h3 id="å’Œæ™®é€šå£°æ˜ä¸€ä¸ª-let-å˜é‡æœ‰å•¥åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#å’Œæ™®é€šå£°æ˜ä¸€ä¸ª-let-å˜é‡æœ‰å•¥åŒºåˆ«" aria-hidden="true">#</a> å’Œæ™®é€šå£°æ˜ä¸€ä¸ª let å˜é‡æœ‰å•¥åŒºåˆ«</h3>
<ul>
<li>æ™®é€šå˜é‡åœ¨æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼ŒuseRef åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒå”¯ä¸€</li>
</ul>
<p>ç›¸å…³èµ„æ–™ï¼š<a href="https://zhuanlan.zhihu.com/p/22486908" target="_blank" rel="noopener noreferrer">é—­åŒ…<ExternalLinkIcon/></a>
ã€Œå‡½æ•°ã€å’Œã€Œå‡½æ•°å†…éƒ¨èƒ½è®¿é—®åˆ°çš„å˜é‡ã€ï¼ˆä¹Ÿå«ç¯å¢ƒï¼‰çš„æ€»å’Œï¼Œå°±æ˜¯ä¸€ä¸ªé—­åŒ…</p>
<h3 id="å’Œ-usestate-å¼‚åŒç‚¹" tabindex="-1"><a class="header-anchor" href="#å’Œ-usestate-å¼‚åŒç‚¹" aria-hidden="true">#</a> å’Œ useState å¼‚åŒç‚¹</h3>
<ul>
<li>ç›¸åŒç‚¹ï¼šéƒ½èƒ½ä¿è¯ç»„ä»¶å¤šæ¬¡æ¸²æŸ“æ˜¯å€¼ä¸å˜</li>
<li>ä¸åŒç‚¹ï¼šuseState å˜é‡æ”¹å˜ä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆ-useref-èƒ½å¤Ÿç›´æ¥å¡ç»™ç»„ä»¶çš„-ref" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-useref-èƒ½å¤Ÿç›´æ¥å¡ç»™ç»„ä»¶çš„-ref" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆ useRef èƒ½å¤Ÿç›´æ¥å¡ç»™ç»„ä»¶çš„ ref</h3>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">RefObject<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> current<span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h1 id="useimperativehandle" tabindex="-1"><a class="header-anchor" href="#useimperativehandle" aria-hidden="true">#</a> <a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#useimperativehandle" target="_blank" rel="noopener noreferrer">useImperativeHandle<ExternalLinkIcon/></a></h1>
<p>è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼,é…åˆ forwardRef ä½¿ç”¨,ç±»æ¯” class ç»„ä»¶ä¸­çš„ public å±æ€§</p>
</template>
