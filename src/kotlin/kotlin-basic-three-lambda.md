# [å‡½æ•°](https://book.kotlincn.net/text/functions.html)

```kotlin
fun powerOf(
    number: Int,
    exponent: Int
):Int {  }
```

## é»˜è®¤å‚æ•°

```kotlin
fun read(
    b: ByteArray,
    off: Int = 0,
    len: Int = b.size // å¯ä»¥ç”¨æ ¹æ®å‰é¢å‚æ•°å¾—å‡ºé»˜è®¤å€¼
) { /*â€¦â€¦*/ }
```

è¦†ç›–æ–¹æ³•æ€»æ˜¯ä½¿ç”¨ä¸åŸºç±»å‹æ–¹æ³•ç›¸åŒçš„é»˜è®¤å‚æ•°å€¼ã€‚å½“è¦†ç›–ä¸€ä¸ªæœ‰é»˜è®¤å‚æ•°å€¼çš„æ–¹æ³•æ—¶ï¼Œå¿…é¡»ä»ç­¾åä¸­çœç•¥é»˜è®¤å‚æ•°å€¼

```kotlin
open class A {
    open fun foo(i: Int = 10) { /*â€¦â€¦*/ }
}

class B : A() {
    override fun foo(i: Int) { /*â€¦â€¦*/ }  // ä¸èƒ½æœ‰é»˜è®¤å€¼ã€‚
}

```

å¦‚æœä¸€ä¸ªé»˜è®¤å‚æ•°åœ¨ä¸€ä¸ªæ— é»˜è®¤å€¼çš„å‚æ•°ä¹‹å‰ï¼Œé‚£ä¹ˆè¯¥é»˜è®¤å€¼åªèƒ½é€šè¿‡ä½¿ç”¨å…·åå‚æ•°è°ƒç”¨è¯¥å‡½æ•°æ¥ä½¿ç”¨

```kotlin
fun foo(
    bar: Int = 0,
    baz: Int,
) { /*â€¦â€¦*/ }

foo(baz = 1) // ä½¿ç”¨é»˜è®¤å€¼ bar = 0
```

å¦‚æœåœ¨é»˜è®¤å‚æ•°ä¹‹åçš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯ lambda è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆå®ƒæ—¢å¯ä»¥ä½œä¸ºå…·åå‚æ•°åœ¨æ‹¬å·å†…ä¼ å…¥ï¼Œä¹Ÿå¯ä»¥åœ¨æ‹¬å·å¤–ä¼ å…¥ï¼š

```kotlin
fun foo(
    bar: Int = 0,
    baz: Int = 1,
    qux: () -> Unit,
) { /*â€¦â€¦*/ }

foo(1) { println("hello") }     // ä½¿ç”¨é»˜è®¤å€¼ baz = 1
foo(qux = { println("hello") }) // ä½¿ç”¨ä¸¤ä¸ªé»˜è®¤å€¼ bar = 0 ä¸ baz = 1
foo { println("hello") }
```

## å…·åå‚æ•°

è§£å†³å¤šå‚æ•°ã€éš¾ä»¥å…³è”çš„é—®é¢˜

```kotlin
fun reformat(
    str: String,
    normalizeCase: Boolean = true,
    upperCaseFirstLetter: Boolean = true,
    divideByCamelHumps: Boolean = false,
    wordSeparator: Char = ' ',
) { /*â€¦â€¦*/ }
```

ä¸éœ€è¦æŒ‡æ˜å…¨éƒ¨å‚æ•°

```kotlin
reformat(
    "String!",
    false,
    upperCaseFirstLetter = false,
    divideByCamelHumps = true,
    '_'
)
```

æŸä¸ªå‚æ•°è¢«è·³è¿‡åï¼Œåé¢çš„å‚æ•°å¿…é¡»æŒ‡æ˜å‚æ•°å

```kotlin
reformat("This is a short String!", upperCaseFirstLetter = false, wordSeparator = '_')

```

æ‚¨å¯ä»¥ä½¿ç”¨ spread è¿ç®—ç¬¦ä¼ é€’å…·æœ‰åç§°çš„å¯å˜æ•°é‡çš„å‚æ•°ï¼ˆvarargï¼‰

```kotlin
fun foo(vararg strings: String) { /*â€¦â€¦*/ }

foo(strings = *arrayOf("a", "b", "c"))
```

## å•è¡¨è¾¾å¼å‡½æ•°

å½“å‡½æ•°è¿”å›å•ä¸ªè¡¨è¾¾å¼æ—¶ï¼Œå¯ä»¥çœç•¥èŠ±æ‹¬å·å¹¶ä¸”åœ¨ = ç¬¦å·ä¹‹åæŒ‡å®šä»£ç ä½“å³å¯

```kotlin
fun double(x: Int) = x * 2
```

è¿”å›å€¼ç±»å‹å¯ç”±ç¼–è¯‘å™¨æ¨æ–­æ—¶,æ˜¾å¼å£°æ˜å¯çœ

## å¯å˜æ•°é‡çš„å‚æ•°ï¼ˆvarargsï¼‰

åªæœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥æ ‡æ³¨ä¸º varargï¼Œå¦‚æœ vararg å‚æ•°ä¸æ˜¯åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œ å¯ä»¥ä½¿ç”¨å…·åå‚æ•°è¯­æ³•ä¼ é€’å…¶åçš„å‚æ•°çš„å€¼

```kotlin
fun foo(a: String, vararg b: Int, c:String) {}
foo("",1,2,3, c = "")
```

## ä¸­ç¼€è¡¨ç¤ºæ³•

æ ‡æœ‰ infix å…³é”®å­—çš„å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸­ç¼€è¡¨ç¤ºæ³•ï¼ˆå¿½ç•¥è¯¥è°ƒç”¨çš„ç‚¹ä¸åœ†æ‹¬å·ï¼‰è°ƒç”¨ã€‚ ä¸­ç¼€å‡½æ•°å¿…é¡»æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

- å®ƒä»¬å¿…é¡»æ˜¯æˆå‘˜å‡½æ•°æˆ–[æ‰©å±•å‡½æ•°](https://book.kotlincn.net/text/extensions.html)ã€‚
- å®ƒä»¬å¿…é¡»åªæœ‰ä¸€ä¸ªå‚æ•°ã€‚
- å…¶å‚æ•°ä¸å¾—æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ä¸”ä¸èƒ½æœ‰é»˜è®¤å€¼ã€‚

```kotlin
infix fun Int.shl(x: Int): Int { â€¦â€¦ }

// ç”¨ä¸­ç¼€è¡¨ç¤ºæ³•è°ƒç”¨è¯¥å‡½æ•°
1 shl 2

// ç­‰åŒäºè¿™æ ·
1.shl(2)
```

ä¸­ç¼€å‡½æ•°è°ƒç”¨çš„ä¼˜å…ˆçº§ä½äºç®—æœ¯æ“ä½œç¬¦ã€ç±»å‹è½¬æ¢ä»¥åŠ rangeTo æ“ä½œç¬¦ã€‚ä»¥ä¸‹è¡¨è¾¾å¼æ˜¯ç­‰ä»·çš„ï¼š

- `1 shl 2 + 3` ç­‰ä»·äº `1 shl (2 + 3)`
- `0 until n * 2` ç­‰ä»·äº `0 until (n * 2)`
- `xs union ys as Set<*>` ç­‰ä»·äº `xs union (ys as Set<*>)`

å¦ä¸€æ–¹é¢ï¼Œä¸­ç¼€å‡½æ•°è°ƒç”¨çš„ä¼˜å…ˆçº§é«˜äºå¸ƒå°”æ“ä½œç¬¦ && ä¸ ||ã€is- ä¸ in- æ£€æµ‹ä»¥åŠå…¶ä»–ä¸€äº›æ“ä½œç¬¦ã€‚è¿™äº›è¡¨è¾¾å¼ä¹Ÿæ˜¯ç­‰ä»·çš„ï¼š

- `a && b xor c` ç­‰ä»·äº `a && (b xor c)`
- `a xor b in c` ç­‰ä»·äº `(a xor b) in c`

ä½¿ç”¨ä¸­ç¼€è¡¨ç¤ºæ³•åœ¨å½“å‰æ¥æ”¶è€…ä¸Šè°ƒç”¨æ–¹æ³•æ—¶ï¼Œéœ€è¦æ˜¾å¼ä½¿ç”¨ this

```kotlin
class MyStringCollection {
    infix fun add(s: String) { /*â€¦â€¦*/ }

    fun build() {
        this add "abc"   // æ­£ç¡®
        add("abc")       // æ­£ç¡®
        //add "abc"        // é”™è¯¯ï¼šå¿…é¡»æŒ‡å®šæ¥æ”¶è€…
    }
}
```

## å‡½æ•°ä½œç”¨åŸŸ

Kotlin å‡½æ•°å¯ä»¥åœ¨æ–‡ä»¶é¡¶å±‚å£°æ˜ï¼Œè¿™æ„å‘³ç€ä½ ä¸éœ€è¦åƒä¸€äº›è¯­è¨€å¦‚ Javaã€C# ä¸ Scala é‚£æ ·éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥ä¿å­˜ä¸€ä¸ªå‡½æ•°ã€‚æ­¤å¤–é™¤äº†é¡¶å±‚å‡½æ•°ï¼ŒKotlin ä¸­å‡½æ•°ä¹Ÿå¯ä»¥å£°æ˜åœ¨å±€éƒ¨ä½œç”¨åŸŸã€ä½œä¸ºæˆå‘˜å‡½æ•°ä»¥åŠæ‰©å±•å‡½æ•°ã€‚

### å±€éƒ¨å‡½æ•°

Kotlin æ”¯æŒå±€éƒ¨å‡½æ•°ï¼Œå³ä¸€ä¸ªå‡½æ•°åœ¨å¦ä¸€ä¸ªå‡½æ•°å†…éƒ¨ï¼š

```kotlin
fun dfs(graph: Graph) {
    fun dfs(current: Vertex, visited: MutableSet<Vertex>) {
        if (!visited.add(current)) return
        for (v in current.neighbors)
            dfs(v, visited)
    }

    dfs(graph.vertices[0], HashSet())
}
```

### æ³›å‹å‡½æ•°

å‡½æ•°å¯ä»¥æœ‰æ³›å‹å‚æ•°ï¼Œé€šè¿‡åœ¨å‡½æ•°åå‰ä½¿ç”¨å°–æ‹¬å·æŒ‡å®šï¼š

```kotlin
fun <T> singletonList(item: T): List<T> { /*â€¦â€¦*/ }
```

### å°¾é€’å½’

å½“ä¸€ä¸ªå‡½æ•°ç”¨ tailrec ä¿®é¥°ç¬¦æ ‡è®°å¹¶æ»¡è¶³æ‰€éœ€çš„å½¢å¼æ¡ä»¶æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¼˜åŒ–è¯¥é€’å½’ï¼Œ ç•™ä¸‹ä¸€ä¸ªå¿«é€Ÿè€Œé«˜æ•ˆçš„åŸºäºå¾ªç¯çš„ç‰ˆæœ¬

```kotlin
val eps = 1E-10

tailrec fun findFixPoint(x: Double = 1.0): Double =
    if (Math.abs(x - Math.cos(x)) < eps) x else findFixPoint(Math.cos(x))
```

è¦ç¬¦åˆ tailrec ä¿®é¥°ç¬¦çš„æ¡ä»¶çš„è¯ï¼Œå‡½æ•°å¿…é¡»å°†å…¶è‡ªèº«è°ƒç”¨ä½œä¸ºå®ƒæ‰§è¡Œçš„æœ€åä¸€ä¸ªæ“ä½œã€‚åœ¨é€’å½’è°ƒç”¨åæœ‰æ›´å¤šä»£ç æ—¶ï¼Œ ä¸èƒ½ä½¿ç”¨å°¾é€’å½’

# é«˜é˜¶å‡½æ•°ä¸ lambda è¡¨è¾¾å¼

éƒ½æ˜¯æ–°çŸ¥è¯†ç‚¹ï¼šå‚é˜…[åŸæ–‡](https://book.kotlincn.net/text/lambdas.html)

Kotlin å‡½æ•°éƒ½æ˜¯å¤´ç­‰çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸æ•°æ®ç»“æ„ä¸­.(å’Œ TS éå¸¸åƒ)

## é«˜é˜¶å‡½æ•°

é«˜é˜¶å‡½æ•°æ˜¯å°†å‡½æ•°ç”¨ä½œå‚æ•°æˆ–è¿”å›å€¼çš„å‡½æ•°

## å‡½æ•°ç±»å‹

å‡½æ•°ç±»å‹è¡¨ç¤ºæ³•å¯ä»¥é€‰æ‹©æ€§åœ°åŒ…å«å‡½æ•°çš„å‚æ•°åï¼š`(x: Int, y: Int) -> Point`ã€‚ è¿™äº›åç§°å¯ç”¨äºè¡¨æ˜å‚æ•°çš„å«ä¹‰

å‡½æ•°ç±»å‹æŒ‡å®šä¸ºå¯ç©ºï¼Œè¯·ä½¿ç”¨åœ†æ‹¬å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š `((Int, Int) -> Int)?`ã€‚

å‡½æ•°ç±»å‹è¿˜å¯ä»¥ä½¿ç”¨åœ†æ‹¬å·è¿›è¡Œæ¥åˆï¼š`(Int) -> ((Int) -> Unit)`ã€‚

> ç®­å¤´è¡¨ç¤ºæ³•æ˜¯å³ç»“åˆçš„ï¼Œ`(Int) -> (Int) -> Unit` ä¸å‰è¿°ç¤ºä¾‹ç­‰ä»·

å¯ä»¥é€šè¿‡ä½¿ç”¨[ç±»å‹åˆ«å](https://book.kotlincn.net/text/type-aliases.html)ç»™å‡½æ•°ç±»å‹èµ·ä¸€ä¸ªåˆ«ç§°ï¼š

```kotlin
typealias ClickHandler = (Button, ClickEvent) -> Unit
```

## å‡½æ•°ç±»å‹å®ä¾‹åŒ–

è·å¾—å‡½æ•°ç±»å‹çš„å®ä¾‹

- ä½¿ç”¨å‡½æ•°å­—é¢å€¼çš„ä»£ç å—
  - lambda è¡¨è¾¾å¼: `{ a, b -> a + b }`
  - åŒ¿åå‡½æ•°: `fun(s: String): Int { return s.toIntOrNull() ?: 0 }`
- ??ä½¿ç”¨å·²æœ‰å£°æ˜çš„å¯è°ƒç”¨å¼•ç”¨ï¼š
  - é¡¶å±‚ã€å±€éƒ¨ã€æˆå‘˜ã€æ‰©å±•å‡½æ•°ï¼š`::isOdd`ã€ `String::toInt`ï¼Œ
  - é¡¶å±‚ã€æˆå‘˜ã€æ‰©å±•å±æ€§ï¼š`List<Int>::size`ï¼Œ
  - æ„é€ å‡½æ•°ï¼š`::Regex`
- ä½¿ç”¨å®ç°å‡½æ•°ç±»å‹æ¥å£çš„è‡ªå®šä¹‰ç±»çš„å®ä¾‹
  > ğŸ“¢ï¼šæ³¨æ„å†™æ³•

```kotlin
class IntTransformer: (Int) -> Int {
    override operator fun invoke(x: Int): Int = TODO()
}

val intFunction: (Int) -> Int = IntTransformer()
```

ä¸ä¸å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹éå­—é¢å€¼å¯ä»¥äº’æ¢ï¼Œå…¶ä¸­æ¥æ”¶è€…å¯ä»¥æ›¿ä»£ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåä¹‹äº¦ç„¶ã€‚ä¾‹å¦‚ï¼Œ`(A, B) -> C` ç±»å‹çš„å€¼å¯ä»¥ä¼ ç»™æˆ–èµ‹å€¼ç»™æœŸå¾… `A.(B) -> C`

?? åé¢ä¸€ç§å†™æ³•çš„æ„æ€(æ‰©å±•å‡½æ•°)

```kotlin
fun main() {
    val repeatFun: String.(Int) -> String = { times -> this.repeat(times) }
    val twoParameters: (String, Int) -> String = repeatFun // OK

    fun runTransformation(f: (String, Int) -> String): String {
        return f("hello", 3)
    }
    val result = runTransformation(repeatFun) // OK
    println("result = $result")
}
```

?? å¦‚æœè¯¥å€¼å…·æœ‰??æ¥æ”¶è€…ç±»å‹ï¼Œé‚£ä¹ˆåº”è¯¥å°†æ¥æ”¶è€…å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚ è°ƒç”¨å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹å€¼çš„å¦ä¸€ä¸ªæ–¹å¼æ˜¯åœ¨å…¶å‰é¢åŠ ä¸Šæ¥æ”¶è€…å¯¹è±¡ï¼Œ å°±å¥½æ¯”è¯¥å€¼æ˜¯ä¸€ä¸ªæ‹“å±•å‡½æ•°

## Lambda è¡¨è¾¾å¼ä¸åŒ¿åå‡½æ•°

Lambda è¡¨è¾¾å¼è¯­æ³•

```kotlin
val sum: (Int, Int) -> Int = { x: Int, y: Int -> x + y }
```

å¦‚æœå°†æ‰€æœ‰å¯é€‰æ ‡æ³¨éƒ½ç•™ä¸‹ï¼Œçœ‹èµ·æ¥å¦‚ä¸‹ï¼š

```kotlin
val sum = { x: Int, y: Int -> x + y }
```

## ä¼ é€’æœ«å°¾çš„ lambda è¡¨è¾¾å¼

æŒ‰ç…§ Kotlin æƒ¯ä¾‹ï¼Œå¦‚æœå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆä½œä¸ºç›¸åº”å‚æ•°ä¼ å…¥çš„ lambda è¡¨è¾¾å¼å¯ä»¥æ”¾åœ¨åœ†æ‹¬å·ä¹‹å¤–ï¼š

```kotlin
val product = items.fold(1) { acc, e -> acc * e }

```

è¿™ç§è¯­æ³•ä¹Ÿç§°ä¸ºæ‹–å°¾ lambda è¡¨è¾¾å¼ã€‚
å¦‚æœè¯¥ lambda è¡¨è¾¾å¼æ˜¯è°ƒç”¨æ—¶å”¯ä¸€çš„å‚æ•°ï¼Œé‚£ä¹ˆåœ†æ‹¬å·å¯ä»¥å®Œå…¨çœç•¥ï¼š
// ?? run

```kotlin
run { println("...") }
```

## `it` å•ä¸ªå‚æ•°çš„éšå¼åç§°

## ä» lambda è¡¨è¾¾å¼è¿”å›å€¼

å¯ä»¥ä½¿ç”¨é™å®šçš„è¿”å›è¯­æ³•ä» lambda æ˜¾å¼è¿”å›ä¸€ä¸ªå€¼ã€‚ å¦åˆ™ï¼Œå°†éšå¼è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼

```kotlin
strings.filter { it.length == 5 }.sortedBy { it }.map { it.uppercase() }
```

## å¸¦æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼

# question list

- å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹å®ä¾‹
- ::
- æ¥æ”¶è€…ç±»å‹
- lambdaï¼šrun è°ƒç”¨
